<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLEASEME - Sistema de Facturaci√≥n</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600;700&family=Work+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --dorado: #d4af37;
            --dorado-oscuro: #b8962d;
            --dorado-hover: #e8c653;
            --negro: #0a0a0a;
            --gris-oscuro: #1a1a1a;
            --gris-medio: #2a2a2a;
            --gris-claro: #444444;
            --blanco: #ffffff;
            --texto-claro: #e0e0e0;
            --borde: #333333;
            --sombra: rgba(212, 175, 55, 0.15);
            --verde: #2fa36f;
            --verde-hover: #38c27a;
            --rojo: #c84040;
        }

        body {
            font-family: 'Work Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: var(--texto-claro);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(212, 175, 55, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(212, 175, 55, 0.02) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        /* HEADER */
        .header {
            background: var(--gris-oscuro);
            border: 1px solid var(--borde);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 24px var(--sombra);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--dorado), transparent);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .logo-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--dorado) 0%, var(--dorado-oscuro) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Spectral', serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--negro);
            box-shadow: 0 8px 32px rgba(212, 175, 55, 0.3);
            border: 3px solid rgba(255, 255, 255, 0.1);
        }

        .company-info h1 {
            font-family: 'Spectral', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--dorado);
            margin-bottom: 0.25rem;
            letter-spacing: -0.02em;
        }

        .company-info p {
            color: var(--texto-claro);
            opacity: 0.8;
            font-size: 0.95rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        /* BOTONES */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-family: 'Work Sans', sans-serif;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            white-space: nowrap;
        }

        .btn-primary {
            background: var(--dorado);
            color: var(--negro);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }

        .btn-primary:hover {
            background: var(--dorado-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }

        .btn-secondary {
            background: var(--gris-medio);
            color: var(--texto-claro);
            border: 1px solid var(--borde);
        }

        .btn-secondary:hover {
            background: var(--gris-claro);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--verde);
            color: white;
        }

        .btn-success:hover {
            background: var(--verde-hover);
            transform: translateY(-2px);
        }

        .btn-icon {
            font-size: 1.2rem;
        }

        /* GRID PRINCIPAL */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .card {
            background: var(--gris-oscuro);
            border: 1px solid var(--borde);
            border-radius: 16px;
            padding: 1.25rem;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
        }

        .card-title {
            font-family: 'Spectral', serif;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dorado);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        /* FORMULARIOS */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .form-group {
            margin-bottom: 0.75rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            color: var(--dorado);
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 0.35rem;
            letter-spacing: 0.02em;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.5rem 0.75rem;
            background: var(--negro);
            border: 1px solid var(--borde);
            border-radius: 8px;
            color: var(--texto-claro);
            font-family: 'Work Sans', sans-serif;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--dorado);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        input::placeholder {
            color: rgba(224, 224, 224, 0.3);
        }

        input:disabled {
            background: var(--gris-medio);
            cursor: not-allowed;
            opacity: 0.6;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            font-family: 'Work Sans', sans-serif;
        }

        /* TABLA DE ART√çCULOS */
        .items-section {
            grid-column: 1 / -1;
        }

        .items-input {
            display: grid;
            grid-template-columns: 2fr 0.8fr 1fr auto;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: end;
        }

        .table-container {
            background: var(--negro);
            border: 1px solid var(--borde);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--gris-medio);
        }

        th {
            padding: 1rem;
            text-align: left;
            color: var(--dorado);
            font-weight: 600;
            font-size: 0.9rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        th:last-child {
            text-align: right;
        }

        td {
            padding: 1rem;
            border-top: 1px solid var(--borde);
            color: var(--texto-claro);
        }

        td:last-child {
            text-align: right;
        }

        tbody tr {
            transition: background 0.2s ease;
        }

        tbody tr:hover {
            background: rgba(212, 175, 55, 0.05);
        }

        .delete-btn {
            background: none;
            border: none;
            color: var(--rojo);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0.25rem 0.5rem;
            transition: all 0.2s ease;
        }

        .delete-btn:hover {
            transform: scale(1.2);
            color: #ff5555;
        }

        /* TOTALES */
        .totals-section {
            background: var(--gris-medio);
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid var(--borde);
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--borde);
        }

        .total-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .total-label {
            color: var(--dorado);
            font-weight: 500;
        }

        .total-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--texto-claro);
        }

        .total-final {
            font-size: 2rem;
            color: var(--dorado);
            font-family: 'Spectral', serif;
            font-weight: 700;
        }

        /* MENSAJES */
        .messages-box {
            background: var(--negro);
            border: 1px solid var(--borde);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .message-item {
            background: var(--gris-medio);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .message-item:last-child {
            margin-bottom: 0;
        }

        /* ACCIONES PRINCIPALES */
        .main-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            padding: 2rem;
            background: var(--gris-oscuro);
            border: 1px solid var(--borde);
            border-radius: 16px;
            flex-wrap: wrap;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease;
        }

        .modal.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--gris-oscuro);
            border: 1px solid var(--dorado);
            border-radius: 16px;
            padding: 2rem;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 8px 48px rgba(212, 175, 55, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-title {
            font-family: 'Spectral', serif;
            font-size: 2rem;
            color: var(--dorado);
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--texto-claro);
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            line-height: 1;
        }

        .close-btn:hover {
            color: var(--dorado);
            transform: rotate(90deg);
        }

        /* B√öSQUEDA DE CLIENTES */
        .search-results {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 1rem;
        }

        .client-item {
            background: var(--negro);
            border: 1px solid var(--borde);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .client-item:hover {
            background: var(--gris-medio);
            border-color: var(--dorado);
            transform: translateX(4px);
        }

        .client-name {
            font-weight: 600;
            color: var(--dorado);
            margin-bottom: 0.25rem;
        }

        .client-details {
            font-size: 0.9rem;
            color: var(--texto-claro);
            opacity: 0.8;
        }

        /* LISTA DE FACTURAS */
        .invoice-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .invoice-item {
            background: var(--negro);
            border: 1px solid var(--borde);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            display: grid;
            grid-template-columns: auto 1fr auto auto;
            gap: 1.5rem;
            align-items: center;
            transition: all 0.2s ease;
        }

        .invoice-item:hover {
            border-color: var(--dorado);
            background: var(--gris-medio);
        }

        .invoice-number {
            font-family: 'Spectral', serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dorado);
        }

        .invoice-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .invoice-client {
            font-weight: 500;
            color: var(--texto-claro);
        }

        .invoice-date {
            font-size: 0.9rem;
            color: var(--texto-claro);
            opacity: 0.7;
        }

        .invoice-total {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dorado);
            font-family: 'Spectral', serif;
        }

        /* ESTAD√çSTICAS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--gris-medio);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--borde);
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--dorado);
            font-family: 'Spectral', serif;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--texto-claro);
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* FILTROS */
        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        /* SCROLLBAR PERSONALIZADO */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--negro);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gris-claro);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--dorado);
        }

        /* ANIMACIONES */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            animation: pulse 1.5s ease-in-out infinite;
        }

        /* TOOLTIP */
        [data-tooltip] {
            position: relative;
        }

        [data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background: var(--negro);
            color: var(--dorado);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.85rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            border: 1px solid var(--dorado);
        }

        [data-tooltip]:hover::after {
            opacity: 1;
        }

        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header {
                flex-direction: column;
                gap: 1.5rem;
                text-align: center;
            }

            .logo-section {
                flex-direction: column;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .items-input {
                grid-template-columns: 1fr;
            }

            .main-actions {
                flex-direction: column;
            }

            .invoice-item {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .company-info h1 {
                font-size: 2rem;
            }
        }

        /* BADGE */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .badge-success {
            background: rgba(47, 163, 111, 0.2);
            color: var(--verde-hover);
            border: 1px solid var(--verde);
        }

        .badge-warning {
            background: rgba(212, 175, 55, 0.2);
            color: var(--dorado-hover);
            border: 1px solid var(--dorado);
        }

        .badge-danger {
            background: rgba(200, 64, 64, 0.2);
            color: #ff5555;
            border: 1px solid var(--rojo);
        }

        /* EMPTY STATE */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--texto-claro);
            opacity: 0.6;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-state-text {
            font-size: 1.1rem;
        }

        /* SUGERENCIAS DE CLIENTE */
        .sugerencias-container {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--gris-oscuro);
            border: 1px solid var(--dorado);
            border-radius: 8px;
            margin-top: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
        }

        .sugerencia-item {
            padding: 1rem;
            cursor: pointer;
            border-bottom: 1px solid var(--borde);
            transition: all 0.2s ease;
        }

        .sugerencia-item:last-child {
            border-bottom: none;
        }

        .sugerencia-item:hover {
            background: var(--gris-medio);
            padding-left: 1.5rem;
        }

        .sugerencia-nombre {
            font-weight: 600;
            color: var(--dorado);
            margin-bottom: 0.25rem;
        }

        .sugerencia-detalles {
            font-size: 0.9rem;
            color: var(--texto-claro);
            opacity: 0.8;
        }

        /* SEPARATOR */
        hr {
            border: none;
            border-top: 1px solid var(--borde);
            margin: 1.5rem 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <header class="header">
            <div class="logo-section">
                <div class="logo-circle" id="logoEmpresa">PM</div>
                <div class="company-info">
                    <h1 id="nombreEmpresa">PLEASEME LLC</h1>
                    <p id="sloganEmpresa">Sistema de Facturaci√≥n Profesional</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="openModal('configEmpresaModal')">
                    <span class="btn-icon">‚öôÔ∏è</span> Configuraci√≥n
                </button>
                <button class="btn btn-secondary" onclick="openModal('ventasModal')">
                    <span class="btn-icon">üí∞</span> Ventas
                </button>
                <button class="btn btn-secondary" onclick="openModal('articulosModal')">
                    <span class="btn-icon">üì¶</span> Art√≠culos
                </button>
                <button class="btn btn-secondary" onclick="openModal('clientesModal')">
                    <span class="btn-icon">üë•</span> Clientes
                </button>
            </div>
        </header>

        <!-- FORMULARIO PRINCIPAL -->
        <div class="card" style="margin-bottom: 1.5rem;">
            <h2 class="card-title">
                <span>üìã</span>
                Informaci√≥n de la Factura
            </h2>
            
            <!-- DATOS DE FACTURA Y PAGO -->
            <div class="form-row">
                <div class="form-group">
                    <label for="numeroFactura">N¬∫ Factura</label>
                    <input type="text" id="numeroFactura" value="FAC-0001" disabled>
                </div>
                <div class="form-group">
                    <label for="fechaFactura">Fecha</label>
                    <input type="date" id="fechaFactura">
                </div>
                <div class="form-group">
                    <label for="tipoPago">Tipo de Pago</label>
                    <select id="tipoPago">
                        <option>Efectivo</option>
                        <option>Zelle</option>
                        <option>Cash App</option>
                        <option>Tarjeta</option>
                        <option>Transferencia</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modoVenta">Modo de Venta</label>
                    <select id="modoVenta" onchange="togglePagoInicial()">
                        <option>Contado</option>
                        <option>Cr√©dito</option>
                    </select>
                </div>
            </div>

            <hr style="border: none; border-top: 1px solid var(--borde); margin: 1rem 0;">

            <!-- DATOS DEL CLIENTE -->
            <h3 style="color: var(--dorado); font-size: 1.1rem; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                <span>üë§</span> Datos del Cliente
            </h3>
            
            <div class="form-group">
                <label for="clienteNombre">Nombre del Cliente</label>
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" id="clienteNombre" placeholder="Escriba el nombre del cliente..." oninput="buscarClienteAutomatico()">
                    <button class="btn btn-primary" onclick="openModal('buscarClienteModal')" style="padding: 0.5rem 0.75rem;" data-tooltip="Ver todos los clientes">
                        <span>üîç</span>
                    </button>
                    <button class="btn btn-success" onclick="limpiarCliente()" style="padding: 0.5rem 0.75rem;" data-tooltip="Limpiar Cliente">
                        <span>üîÑ</span>
                    </button>
                </div>
                <div id="sugerenciasCliente" style="position: relative;"></div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="clienteTelefono">Tel√©fono</label>
                    <input type="tel" id="clienteTelefono" placeholder="(555) 123-4567">
                </div>
                <div class="form-group">
                    <label for="clienteCorreo">Correo Electr√≥nico</label>
                    <input type="email" id="clienteCorreo" placeholder="cliente@email.com">
                </div>
            </div>
            
            <div class="form-group">
                <label for="clienteDireccion">Direcci√≥n Completa</label>
                <input type="text" id="clienteDireccion" placeholder="Calle y n√∫mero">
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="clienteZip">C√≥digo Postal</label>
                    <input type="text" id="clienteZip" placeholder="12345" maxlength="5" onblur="buscarZip()">
                </div>
                <div class="form-group">
                    <label for="clienteCiudad">Ciudad</label>
                    <input type="text" id="clienteCiudad" placeholder="Ciudad">
                </div>
                <div class="form-group">
                    <label for="clienteEstado">Estado</label>
                    <input type="text" id="clienteEstado" placeholder="TX" maxlength="2">
                </div>
            </div>
        </div>

        <!-- ART√çCULOS -->
        <div class="card items-section">
            <h2 class="card-title">
                <span>üìù</span>
                Art√≠culos
            </h2>
            <div class="items-input">
                <div class="form-group">
                    <label for="itemDescripcion">Descripci√≥n</label>
                    <input type="text" id="itemDescripcion" placeholder="Descripci√≥n del art√≠culo">
                </div>
                <div class="form-group">
                    <label for="itemCantidad">Cantidad</label>
                    <input type="number" id="itemCantidad" value="1" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label for="itemPrecio">Precio</label>
                    <input type="number" id="itemPrecio" placeholder="0.00" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label style="opacity: 0;">Agregar</label>
                    <button class="btn btn-primary" onclick="agregarItem()">
                        <span class="btn-icon">‚ûï</span> Agregar
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Descripci√≥n</th>
                            <th style="text-align: center;">Cant.</th>
                            <th style="text-align: right;">Precio</th>
                            <th style="text-align: right;">Total</th>
                            <th style="text-align: center;">Acci√≥n</th>
                        </tr>
                    </thead>
                    <tbody id="itemsTableBody">
                        <tr>
                            <td colspan="5" class="empty-state">
                                <div class="empty-state-icon">üì¶</div>
                                <div class="empty-state-text">No hay art√≠culos agregados</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- MENSAJES -->
            <div class="form-group">
                <label for="mensajeFactura">Mensajes / Notas</label>
                <textarea id="mensajeFactura" placeholder="Agregar notas o mensajes para esta factura..."></textarea>
            </div>
        </div>

        <!-- TOTALES Y ACCIONES -->
        <div class="card">
            <h2 class="card-title">
                <span>üíµ</span>
                Totales
            </h2>
            <div class="totals-section">
                <div class="total-row">
                    <span class="total-label">Subtotal:</span>
                    <span class="total-value" id="subtotalDisplay">$0.00</span>
                </div>
                <div class="total-row">
                    <span class="total-label">Descuento (%):</span>
                    <input type="number" id="descuento" value="0" min="0" max="100" 
                           style="width: 100px; text-align: right;" onchange="calcularTotales()">
                </div>
                <div class="total-row">
                    <span class="total-label">Env√≠o:</span>
                    <input type="number" id="envio" value="0" min="0" step="0.01" 
                           style="width: 150px; text-align: right;" onchange="calcularTotales()">
                </div>
                <div class="total-row" id="pagoInicialRow" style="display: none;">
                    <span class="total-label">Pago Inicial:</span>
                    <input type="number" id="pagoInicial" value="0" min="0" step="0.01" 
                           style="width: 150px; text-align: right;" onchange="calcularTotales()">
                </div>
                <div class="total-row">
                    <span class="total-label">TOTAL:</span>
                    <span class="total-final" id="totalDisplay">$0.00</span>
                </div>
            </div>
        </div>

        <!-- ACCIONES PRINCIPALES -->
        <div class="main-actions">
            <button class="btn btn-success" onclick="nuevaFactura()">
                <span class="btn-icon">üü¢</span> Nueva Factura
            </button>
            <button class="btn btn-primary" onclick="crearFactura()">
                <span class="btn-icon">üìù</span> Crear Factura
            </button>
            <button class="btn btn-primary" onclick="generarPDF()">
                <span class="btn-icon">üìÑ</span> Generar PDF
            </button>
            <button class="btn btn-primary" onclick="imprimirFactura()">
                <span class="btn-icon">üñ®Ô∏è</span> Imprimir
            </button>
        </div>
    </div>

    <!-- MODAL: BUSCAR CLIENTE -->
    <div id="buscarClienteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üîç Clientes Registrados</h2>
                <button class="close-btn" onclick="closeModal('buscarClienteModal')">√ó</button>
            </div>
            <div class="form-group">
                <label for="buscarClienteInput">Buscar por nombre, tel√©fono o correo</label>
                <input type="text" id="buscarClienteInput" placeholder="Escriba para filtrar..." oninput="buscarClientes()">
            </div>
            <div class="search-results" id="clientesResults" style="max-height: 500px;">
                <div class="empty-state">
                    <div class="empty-state-icon">üë•</div>
                    <div class="empty-state-text">Cargando clientes...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: REGISTRAR NUEVO CLIENTE -->
    <div id="registrarClienteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‚ûï Registrar Nuevo Cliente</h2>
                <button class="close-btn" onclick="closeModal('registrarClienteModal')">√ó</button>
            </div>
            
            <div class="form-group">
                <label for="nuevoClienteNombre">Nombre Completo *</label>
                <input type="text" id="nuevoClienteNombre" placeholder="Nombre del cliente" required>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="nuevoClienteTelefono">Tel√©fono</label>
                    <input type="tel" id="nuevoClienteTelefono" placeholder="(555) 123-4567">
                </div>
                <div class="form-group">
                    <label for="nuevoClienteCorreo">Correo Electr√≥nico</label>
                    <input type="email" id="nuevoClienteCorreo" placeholder="cliente@email.com">
                </div>
            </div>

            <div class="form-group">
                <label for="nuevoClienteDireccion">Direcci√≥n Completa</label>
                <input type="text" id="nuevoClienteDireccion" placeholder="Calle y n√∫mero">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="nuevoClienteZip">C√≥digo Postal</label>
                    <input type="text" id="nuevoClienteZip" placeholder="12345" maxlength="5" onblur="buscarZipNuevoCliente()">
                </div>
                <div class="form-group">
                    <label for="nuevoClienteCiudad">Ciudad</label>
                    <input type="text" id="nuevoClienteCiudad" placeholder="Ciudad">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="nuevoClienteEstado">Estado</label>
                    <input type="text" id="nuevoClienteEstado" placeholder="TX" maxlength="2">
                </div>
                <div class="form-group">
                    <label for="nuevoClientePais">Pa√≠s</label>
                    <select id="nuevoClientePais">
                        <option value="USA">Estados Unidos</option>
                        <option value="MX">M√©xico</option>
                        <option value="CA">Canad√°</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="nuevoClienteNotas">Notas / Observaciones</label>
                <textarea id="nuevoClienteNotas" placeholder="Informaci√≥n adicional del cliente..." style="min-height: 80px;"></textarea>
            </div>

            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                <button class="btn btn-success" onclick="guardarNuevoCliente()" style="flex: 1;">
                    <span class="btn-icon">üíæ</span> Guardar Cliente
                </button>
                <button class="btn btn-secondary" onclick="limpiarFormularioCliente()" style="flex: 1;">
                    <span class="btn-icon">üîÑ</span> Limpiar
                </button>
                <button class="btn btn-secondary" onclick="closeModal('registrarClienteModal')">
                    <span class="btn-icon">‚ùå</span> Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL: CONFIGURACI√ìN DE EMPRESA -->
    <div id="configEmpresaModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 class="modal-title">‚öôÔ∏è Configuraci√≥n de la Empresa</h2>
                <button class="close-btn" onclick="closeModal('configEmpresaModal')">√ó</button>
            </div>

            <div class="form-row">
                <!-- Logo de la empresa -->
                <div class="form-group">
                    <label for="configLogoEmpresa">Logo de la Empresa</label>
                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                        <div id="logoPreview" style="width: 120px; height: 120px; border-radius: 50%; background: var(--gris-medio); display: flex; align-items: center; justify-content: center; border: 2px solid var(--dorado); overflow: hidden;">
                            <span id="logoPreviewText" style="font-size: 3rem; color: var(--dorado); font-weight: bold;">PM</span>
                            <img id="logoPreviewImg" style="display: none; width: 100%; height: 100%; object-fit: cover;">
                        </div>
                        <input type="file" id="configLogoEmpresa" accept="image/*" onchange="cargarLogo()" style="padding: 0.5rem;">
                        <button class="btn btn-secondary" onclick="eliminarLogo()" style="width: 100%;">
                            <span class="btn-icon">üóëÔ∏è</span> Eliminar Logo
                        </button>
                    </div>
                </div>

                <!-- Informaci√≥n b√°sica -->
                <div style="flex: 1;">
                    <div class="form-group">
                        <label for="configNombreEmpresa">Nombre de la Empresa *</label>
                        <input type="text" id="configNombreEmpresa" placeholder="Nombre de tu empresa">
                    </div>

                    <div class="form-group">
                        <label for="configSloganEmpresa">Eslogan / Descripci√≥n</label>
                        <input type="text" id="configSloganEmpresa" placeholder="Descripci√≥n breve de tu negocio">
                    </div>

                    <div class="form-group">
                        <label for="configTaxId">Tax ID / EIN</label>
                        <input type="text" id="configTaxId" placeholder="XX-XXXXXXX">
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="configTelefonoEmpresa">Tel√©fono</label>
                    <input type="tel" id="configTelefonoEmpresa" placeholder="(555) 123-4567">
                </div>
                <div class="form-group">
                    <label for="configEmailEmpresa">Correo Electr√≥nico</label>
                    <input type="email" id="configEmailEmpresa" placeholder="contacto@empresa.com">
                </div>
                <div class="form-group">
                    <label for="configWebEmpresa">Sitio Web</label>
                    <input type="text" id="configWebEmpresa" placeholder="www.miempresa.com">
                </div>
            </div>

            <div class="form-group">
                <label for="configDireccionEmpresa">Direcci√≥n</label>
                <input type="text" id="configDireccionEmpresa" placeholder="Calle y n√∫mero">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="configZipEmpresa">C√≥digo Postal</label>
                    <input type="text" id="configZipEmpresa" placeholder="12345" maxlength="5" onblur="buscarZipEmpresa()">
                </div>
                <div class="form-group">
                    <label for="configCiudadEmpresa">Ciudad</label>
                    <input type="text" id="configCiudadEmpresa" placeholder="Ciudad">
                </div>
                <div class="form-group">
                    <label for="configEstadoEmpresa">Estado</label>
                    <input type="text" id="configEstadoEmpresa" placeholder="TX" maxlength="2">
                </div>
                <div class="form-group">
                    <label for="configPaisEmpresa">Pa√≠s</label>
                    <select id="configPaisEmpresa">
                        <option value="USA">Estados Unidos</option>
                        <option value="MX">M√©xico</option>
                        <option value="CA">Canad√°</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="configIniciales">Iniciales para el Logo (si no hay imagen)</label>
                <input type="text" id="configIniciales" placeholder="PM" maxlength="3" style="text-transform: uppercase;">
                <small style="color: var(--texto-claro); opacity: 0.7; display: block; margin-top: 0.25rem;">
                    Se mostrar√°n en el c√≠rculo dorado del logo si no subes una imagen
                </small>
            </div>

            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                <button class="btn btn-success" onclick="guardarConfigEmpresa()" style="flex: 1;">
                    <span class="btn-icon">üíæ</span> Guardar Configuraci√≥n
                </button>
                <button class="btn btn-secondary" onclick="closeModal('configEmpresaModal')">
                    <span class="btn-icon">‚ùå</span> Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL: VENTAS REALIZADAS -->
    <div id="ventasModal" class="modal">
        <div class="modal-content" style="max-width: 1200px;">
            <div class="modal-header">
                <h2 class="modal-title">üí∞ Ventas Realizadas</h2>
                <button class="close-btn" onclick="closeModal('ventasModal')">√ó</button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalVentasCount">0</div>
                    <div class="stat-label">Total Facturas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalVentasAmount">$0.00</div>
                    <div class="stat-label">Total Vendido</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="promedioVentas">$0.00</div>
                    <div class="stat-label">Promedio por Factura</div>
                </div>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <label for="filtroMes">Mes</label>
                    <select id="filtroMes">
                        <option value="">Todos</option>
                        <option value="01">Enero</option>
                        <option value="02">Febrero</option>
                        <option value="03">Marzo</option>
                        <option value="04">Abril</option>
                        <option value="05">Mayo</option>
                        <option value="06">Junio</option>
                        <option value="07">Julio</option>
                        <option value="08">Agosto</option>
                        <option value="09">Septiembre</option>
                        <option value="10">Octubre</option>
                        <option value="11">Noviembre</option>
                        <option value="12">Diciembre</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filtroAno">A√±o</label>
                    <select id="filtroAno">
                        <option value="">Todos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="buscarFactura">Buscar</label>
                    <input type="text" id="buscarFactura" placeholder="Cliente o N¬∫ de factura">
                </div>
                <div class="filter-group">
                    <label style="opacity: 0;">Acci√≥n</label>
                    <button class="btn btn-primary" onclick="filtrarVentas()" style="width: 100%;">
                        <span class="btn-icon">üîç</span> Filtrar
                    </button>
                </div>
            </div>

            <div class="invoice-list" id="ventasList">
                <div class="empty-state">
                    <div class="empty-state-icon">üìä</div>
                    <div class="empty-state-text">No hay ventas registradas</div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: ART√çCULOS -->
    <div id="articulosModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üì¶ Art√≠culos Guardados</h2>
                <button class="close-btn" onclick="closeModal('articulosModal')">√ó</button>
            </div>
            <div class="form-group">
                <label for="buscarArticulo">Buscar art√≠culo</label>
                <input type="text" id="buscarArticulo" placeholder="Buscar por descripci√≥n..." oninput="buscarArticulos()">
            </div>
            <div class="search-results" id="articulosResults">
                <div class="empty-state">
                    <div class="empty-state-icon">üì¶</div>
                    <div class="empty-state-text">No hay art√≠culos guardados</div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: CLIENTES -->
    <div id="clientesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üë• Gesti√≥n de Clientes</h2>
                <button class="close-btn" onclick="closeModal('clientesModal')">√ó</button>
            </div>
            <div class="form-group">
                <label for="buscarClienteGestion">Buscar cliente</label>
                <input type="text" id="buscarClienteGestion" placeholder="Buscar por nombre..." oninput="buscarClientesGestion()">
            </div>
            <div class="search-results" id="clientesGestionResults">
                <div class="empty-state">
                    <div class="empty-state-icon">üë•</div>
                    <div class="empty-state-text">No hay clientes registrados</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DATOS GLOBALES (simulando base de datos)
        let facturas = [];
        let clientes = [];
        let articulos = [];
        let mensajes = [];
        let items = [];
        let facturaActual = 1;
        let configEmpresa = {
            nombre: 'PLEASEME LLC',
            slogan: 'Sistema de Facturaci√≥n Profesional',
            iniciales: 'PM',
            logo: null,
            taxId: '',
            telefono: '',
            email: '',
            web: '',
            direccion: '',
            ciudad: '',
            estado: '',
            zip: '',
            pais: 'USA'
        };

        // INICIALIZACI√ìN
        document.addEventListener('DOMContentLoaded', function() {
            // Establecer fecha actual
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('fechaFactura').value = hoy;
            
            // Cargar datos de localStorage si existen
            cargarDatos();
            
            // Cargar configuraci√≥n de empresa
            cargarConfigEmpresa();
            
            // Generar a√±os para el filtro
            generarAnosSelect();
            
            // Actualizar n√∫mero de factura
            actualizarNumeroFactura();
        });

        // GESTI√ìN DE MODALES
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('active');
            
            // Cargar datos seg√∫n el modal
            if (modalId === 'ventasModal') {
                mostrarVentas();
            } else if (modalId === 'articulosModal') {
                mostrarArticulos();
            } else if (modalId === 'clientesModal') {
                mostrarClientesGestion();
            } else if (modalId === 'configEmpresaModal') {
                mostrarConfigEmpresa();
            } else if (modalId === 'buscarClienteModal') {
                // Limpiar b√∫squeda y mostrar todos los clientes
                document.getElementById('buscarClienteInput').value = '';
                mostrarTodosLosClientes();
            }
        }

        // MOSTRAR TODOS LOS CLIENTES
        function mostrarTodosLosClientes() {
            const container = document.getElementById('clientesResults');
            
            if (clientes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üë•</div>
                        <div class="empty-state-text">No hay clientes registrados</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = clientes.map(cliente => `
                <div class="client-item" onclick='seleccionarCliente(${JSON.stringify(cliente).replace(/'/g, "&#39;")})'>
                    <div class="client-name">${cliente.nombre}</div>
                    <div class="client-details">
                        ${cliente.telefono ? 'üìû ' + cliente.telefono : ''} 
                        ${cliente.telefono && cliente.correo ? ' ‚Ä¢ ' : ''} 
                        ${cliente.correo ? '‚úâÔ∏è ' + cliente.correo : ''}
                        ${cliente.direccion ? '<br>üìç ' + cliente.direccion : ''}
                    </div>
                </div>
            `).join('');
        }

        // BUSCAR CLIENTES (filtrar lista)
        function buscarClientes() {
            const termino = (document.getElementById('buscarClienteInput').value || '').toLowerCase();
            
            if (!termino) {
                mostrarTodosLosClientes();
                return;
            }

            const resultados = clientes.filter(c => 
                c.nombre.toLowerCase().includes(termino) ||
                (c.telefono && c.telefono.includes(termino)) ||
                (c.correo && c.correo.toLowerCase().includes(termino))
            );

            const container = document.getElementById('clientesResults');
            
            if (resultados.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <div class="empty-state-text">No se encontraron clientes</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = resultados.map(cliente => `
                <div class="client-item" onclick='seleccionarCliente(${JSON.stringify(cliente).replace(/'/g, "&#39;")})'>
                    <div class="client-name">${cliente.nombre}</div>
                    <div class="client-details">
                        ${cliente.telefono ? 'üìû ' + cliente.telefono : ''} 
                        ${cliente.telefono && cliente.correo ? ' ‚Ä¢ ' : ''} 
                        ${cliente.correo ? '‚úâÔ∏è ' + cliente.correo : ''}
                        ${cliente.direccion ? '<br>üìç ' + cliente.direccion : ''}
                    </div>
                </div>
            `).join('');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
        }

        // Cerrar modal al hacer clic fuera
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }

        // TOGGLE PAGO INICIAL
        function togglePagoInicial() {
            const modo = document.getElementById('modoVenta').value;
            const row = document.getElementById('pagoInicialRow');
            
            if (modo === 'Cr√©dito') {
                row.style.display = 'flex';
            } else {
                row.style.display = 'none';
                document.getElementById('pagoInicial').value = 0;
            }
            calcularTotales();
        }

        // B√öSQUEDA DE ZIP CODE
        async function buscarZip() {
            const zip = document.getElementById('clienteZip').value;
            if (zip.length === 5) {
                try {
                    const response = await fetch(`https://api.zippopotam.us/us/${zip}`);
                    if (response.ok) {
                        const data = await response.json();
                        document.getElementById('clienteCiudad').value = data.places[0]['place name'];
                        document.getElementById('clienteEstado').value = data.places[0]['state abbreviation'];
                    }
                } catch (error) {
                    console.log('Error buscando c√≥digo postal:', error);
                }
            }
        }

        // B√öSQUEDA DE ZIP CODE PARA EMPRESA
        async function buscarZipEmpresa() {
            const zip = document.getElementById('configZipEmpresa').value;
            if (zip.length === 5) {
                try {
                    const response = await fetch(`https://api.zippopotam.us/us/${zip}`);
                    if (response.ok) {
                        const data = await response.json();
                        document.getElementById('configCiudadEmpresa').value = data.places[0]['place name'];
                        document.getElementById('configEstadoEmpresa').value = data.places[0]['state abbreviation'];
                    }
                } catch (error) {
                    console.log('Error buscando c√≥digo postal:', error);
                }
            }
        }

        // B√öSQUEDA AUTOM√ÅTICA DE CLIENTE
        let timeoutBusqueda = null;
        function buscarClienteAutomatico() {
            clearTimeout(timeoutBusqueda);
            
            const termino = document.getElementById('clienteNombre').value.trim().toLowerCase();
            const container = document.getElementById('sugerenciasCliente');
            
            if (termino.length < 2) {
                container.innerHTML = '';
                return;
            }

            timeoutBusqueda = setTimeout(() => {
                const resultados = clientes.filter(c => 
                    c.nombre.toLowerCase().includes(termino)
                ).slice(0, 5);

                if (resultados.length === 0) {
                    container.innerHTML = '';
                    return;
                }

                container.innerHTML = `
                    <div class="sugerencias-container">
                        ${resultados.map(cliente => `
                            <div class="sugerencia-item" onclick='seleccionarClienteSugerencia(${JSON.stringify(cliente).replace(/'/g, "&#39;")})'>
                                <div class="sugerencia-nombre">${cliente.nombre}</div>
                                <div class="sugerencia-detalles">
                                    ${cliente.telefono || ''} ${cliente.telefono && cliente.correo ? '‚Ä¢' : ''} ${cliente.correo || ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }, 300);
        }

        // SELECCIONAR CLIENTE DE SUGERENCIA
        function seleccionarClienteSugerencia(cliente) {
            document.getElementById('clienteNombre').value = cliente.nombre || '';
            document.getElementById('clienteTelefono').value = cliente.telefono || '';
            document.getElementById('clienteCorreo').value = cliente.correo || '';
            document.getElementById('clienteDireccion').value = cliente.direccion || '';
            document.getElementById('clienteCiudad').value = cliente.ciudad || '';
            document.getElementById('clienteEstado').value = cliente.estado || '';
            document.getElementById('clienteZip').value = cliente.zip || '';
            
            document.getElementById('sugerenciasCliente').innerHTML = '';
        }

        // LIMPIAR CLIENTE
        function limpiarCliente() {
            document.getElementById('clienteNombre').value = '';
            document.getElementById('clienteTelefono').value = '';
            document.getElementById('clienteCorreo').value = '';
            document.getElementById('clienteDireccion').value = '';
            document.getElementById('clienteCiudad').value = '';
            document.getElementById('clienteEstado').value = '';
            document.getElementById('clienteZip').value = '';
            document.getElementById('sugerenciasCliente').innerHTML = '';
        }

        // CONFIGURACI√ìN DE EMPRESA
        function cargarConfigEmpresa() {
            const config = localStorage.getItem('configEmpresa');
            if (config) {
                try {
                    configEmpresa = JSON.parse(config);
                } catch (e) {
                    console.error('Error cargando configuraci√≥n:', e);
                }
            }
            
            // Actualizar UI del header
            document.getElementById('nombreEmpresa').textContent = configEmpresa.nombre;
            document.getElementById('sloganEmpresa').textContent = configEmpresa.slogan;
            
            // Actualizar logo del header
            const logoEmpresaElement = document.getElementById('logoEmpresa');
            if (configEmpresa.logo) {
                logoEmpresaElement.style.backgroundImage = `url(${configEmpresa.logo})`;
                logoEmpresaElement.style.backgroundSize = 'cover';
                logoEmpresaElement.style.backgroundPosition = 'center';
                logoEmpresaElement.textContent = '';
            } else {
                logoEmpresaElement.style.backgroundImage = 'none';
                logoEmpresaElement.textContent = configEmpresa.iniciales;
            }
            
            // Si abrimos el modal, llenar los campos
            if (document.getElementById('configEmpresaModal').classList.contains('active')) {
                mostrarConfigEmpresa();
            }
        }

        function mostrarConfigEmpresa() {
            document.getElementById('configNombreEmpresa').value = configEmpresa.nombre || '';
            document.getElementById('configSloganEmpresa').value = configEmpresa.slogan || '';
            document.getElementById('configIniciales').value = configEmpresa.iniciales || '';
            document.getElementById('configTaxId').value = configEmpresa.taxId || '';
            document.getElementById('configTelefonoEmpresa').value = configEmpresa.telefono || '';
            document.getElementById('configEmailEmpresa').value = configEmpresa.email || '';
            document.getElementById('configWebEmpresa').value = configEmpresa.web || '';
            document.getElementById('configDireccionEmpresa').value = configEmpresa.direccion || '';
            document.getElementById('configCiudadEmpresa').value = configEmpresa.ciudad || '';
            document.getElementById('configEstadoEmpresa').value = configEmpresa.estado || '';
            document.getElementById('configZipEmpresa').value = configEmpresa.zip || '';
            document.getElementById('configPaisEmpresa').value = configEmpresa.pais || 'USA';
            
            // Mostrar logo en el preview
            if (configEmpresa.logo) {
                document.getElementById('logoPreviewImg').src = configEmpresa.logo;
                document.getElementById('logoPreviewImg').style.display = 'block';
                document.getElementById('logoPreviewText').style.display = 'none';
            } else {
                document.getElementById('logoPreviewImg').style.display = 'none';
                document.getElementById('logoPreviewText').style.display = 'block';
                document.getElementById('logoPreviewText').textContent = configEmpresa.iniciales || 'PM';
            }
        }

        function cargarLogo() {
            const input = document.getElementById('configLogoEmpresa');
            const file = input.files[0];
            
            if (file) {
                if (!file.type.startsWith('image/')) {
                    alert('‚ö†Ô∏è Por favor, seleccione un archivo de imagen v√°lido');
                    return;
                }
                
                if (file.size > 2 * 1024 * 1024) {
                    alert('‚ö†Ô∏è La imagen es demasiado grande. M√°ximo 2MB');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const logoData = e.target.result;
                    
                    // Mostrar preview
                    document.getElementById('logoPreviewImg').src = logoData;
                    document.getElementById('logoPreviewImg').style.display = 'block';
                    document.getElementById('logoPreviewText').style.display = 'none';
                    
                    // Guardar temporalmente (se guardar√° definitivamente al hacer click en Guardar)
                    configEmpresa.logo = logoData;
                };
                reader.readAsDataURL(file);
            }
        }

        function eliminarLogo() {
            if (confirm('¬øEst√° seguro que desea eliminar el logo?')) {
                configEmpresa.logo = null;
                document.getElementById('configLogoEmpresa').value = '';
                document.getElementById('logoPreviewImg').style.display = 'none';
                document.getElementById('logoPreviewText').style.display = 'block';
                document.getElementById('logoPreviewText').textContent = configEmpresa.iniciales || 'PM';
            }
        }

        function guardarConfigEmpresa() {
            const nombre = document.getElementById('configNombreEmpresa').value.trim();
            
            if (!nombre) {
                alert('‚ö†Ô∏è Por favor, ingrese el nombre de la empresa');
                return;
            }

            configEmpresa = {
                nombre: nombre,
                slogan: document.getElementById('configSloganEmpresa').value.trim(),
                iniciales: document.getElementById('configIniciales').value.trim().toUpperCase() || nombre.substring(0, 2).toUpperCase(),
                logo: configEmpresa.logo,
                taxId: document.getElementById('configTaxId').value.trim(),
                telefono: document.getElementById('configTelefonoEmpresa').value.trim(),
                email: document.getElementById('configEmailEmpresa').value.trim(),
                web: document.getElementById('configWebEmpresa').value.trim(),
                direccion: document.getElementById('configDireccionEmpresa').value.trim(),
                ciudad: document.getElementById('configCiudadEmpresa').value.trim(),
                estado: document.getElementById('configEstadoEmpresa').value.trim(),
                zip: document.getElementById('configZipEmpresa').value.trim(),
                pais: document.getElementById('configPaisEmpresa').value
            };

            localStorage.setItem('configEmpresa', JSON.stringify(configEmpresa));
            cargarConfigEmpresa();
            
            alert('‚úÖ Configuraci√≥n guardada correctamente');
            closeModal('configEmpresaModal');
        }

        // AGREGAR ITEM
        function agregarItem() {
            const descripcion = document.getElementById('itemDescripcion').value.trim();
            const cantidad = parseFloat(document.getElementById('itemCantidad').value) || 0;
            const precio = parseFloat(document.getElementById('itemPrecio').value) || 0;

            if (!descripcion) {
                alert('Por favor, ingrese una descripci√≥n');
                return;
            }

            if (cantidad <= 0 || precio < 0) {
                alert('Por favor, verifique la cantidad y el precio');
                return;
            }

            const total = cantidad * precio;
            
            const item = {
                descripcion,
                cantidad,
                precio,
                total
            };

            items.push(item);
            
            // Guardar art√≠culo en el cat√°logo
            const articuloExistente = articulos.find(a => a.descripcion.toLowerCase() === descripcion.toLowerCase());
            if (!articuloExistente) {
                articulos.push({ descripcion, precio });
                guardarDatos();
            }

            actualizarTablaItems();
            calcularTotales();

            // Limpiar campos
            document.getElementById('itemDescripcion').value = '';
            document.getElementById('itemPrecio').value = '';
            document.getElementById('itemCantidad').value = '1';
        }

        // ELIMINAR ITEM
        function eliminarItem(index) {
            items.splice(index, 1);
            actualizarTablaItems();
            calcularTotales();
        }

        // ACTUALIZAR TABLA DE ITEMS
        function actualizarTablaItems() {
            const tbody = document.getElementById('itemsTableBody');
            
            if (items.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-state">
                            <div class="empty-state-icon">üì¶</div>
                            <div class="empty-state-text">No hay art√≠culos agregados</div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = items.map((item, index) => `
                <tr>
                    <td>${item.descripcion}</td>
                    <td style="text-align: center;">${item.cantidad.toFixed(2)}</td>
                    <td style="text-align: right;">$${item.precio.toFixed(2)}</td>
                    <td style="text-align: right;">$${item.total.toFixed(2)}</td>
                    <td style="text-align: center;">
                        <button class="delete-btn" onclick="eliminarItem(${index})" data-tooltip="Eliminar">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        // CALCULAR TOTALES
        function calcularTotales() {
            const subtotal = items.reduce((sum, item) => sum + item.total, 0);
            const descuento = parseFloat(document.getElementById('descuento').value) || 0;
            const envio = parseFloat(document.getElementById('envio').value) || 0;
            const pagoInicial = parseFloat(document.getElementById('pagoInicial').value) || 0;
            const modo = document.getElementById('modoVenta').value;

            const subtotalConDescuento = subtotal - (subtotal * (descuento / 100));
            const subtotalConEnvio = subtotalConDescuento + envio;
            const total = modo === 'Cr√©dito' ? Math.max(0, subtotalConEnvio - pagoInicial) : subtotalConEnvio;

            document.getElementById('subtotalDisplay').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('totalDisplay').textContent = `$${total.toFixed(2)}`;
        }

        // AGREGAR MENSAJE
        function agregarMensaje() {
            const texto = document.getElementById('mensajeFactura').value.trim();
            if (!texto) {
                alert('Por favor, escriba un mensaje');
                return;
            }

            mensajes.push(texto);
            actualizarMensajes();
            document.getElementById('mensajeFactura').value = '';
        }

        // ELIMINAR MENSAJE
        function eliminarMensaje(index) {
            mensajes.splice(index, 1);
            actualizarMensajes();
        }

        // ACTUALIZAR LISTA DE MENSAJES
        function actualizarMensajes() {
            const container = document.getElementById('messagesBox');
            
            if (mensajes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üí≠</div>
                        <div class="empty-state-text">No hay mensajes agregados</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = mensajes.map((msg, index) => `
                <div class="message-item">
                    <span>‚Ä¢ ${msg}</span>
                    <button class="delete-btn" onclick="eliminarMensaje(${index})">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        // CREAR FACTURA
        function crearFactura() {
            const cliente = document.getElementById('clienteNombre').value.trim();
            
            if (!cliente) {
                alert('‚ö†Ô∏è Por favor, escriba el nombre del cliente.\n\nEl sistema buscar√° autom√°ticamente si ya existe en la base de datos.');
                document.getElementById('clienteNombre').focus();
                return;
            }

            if (items.length === 0) {
                alert('‚ö†Ô∏è Por favor, agregue al menos un art√≠culo a la factura');
                return;
            }

            const subtotal = items.reduce((sum, item) => sum + item.total, 0);
            const descuento = parseFloat(document.getElementById('descuento').value) || 0;
            const envio = parseFloat(document.getElementById('envio').value) || 0;
            const pagoInicial = parseFloat(document.getElementById('pagoInicial').value) || 0;
            const modo = document.getElementById('modoVenta').value;
            const subtotalConDescuento = subtotal - (subtotal * (descuento / 100));
            const subtotalConEnvio = subtotalConDescuento + envio;
            const total = modo === 'Cr√©dito' ? Math.max(0, subtotalConEnvio - pagoInicial) : subtotalConEnvio;

            const factura = {
                numero: document.getElementById('numeroFactura').value,
                fecha: document.getElementById('fechaFactura').value,
                cliente: cliente,
                telefono: document.getElementById('clienteTelefono').value,
                correo: document.getElementById('clienteCorreo').value,
                direccion: document.getElementById('clienteDireccion').value,
                ciudad: document.getElementById('clienteCiudad').value,
                estado: document.getElementById('clienteEstado').value,
                zip: document.getElementById('clienteZip').value,
                tipoPago: document.getElementById('tipoPago').value,
                modoVenta: modo,
                items: [...items],
                mensajes: [],
                subtotal: subtotal,
                descuento: descuento,
                envio: envio,
                pagoInicial: pagoInicial,
                total: total
            };

            facturas.push(factura);

            // Guardar/actualizar cliente
            const clienteExistente = clientes.find(c => 
                c.nombre.toLowerCase() === cliente.toLowerCase()
            );

            if (!clienteExistente) {
                clientes.push({
                    nombre: cliente,
                    telefono: factura.telefono,
                    correo: factura.correo,
                    direccion: factura.direccion,
                    ciudad: factura.ciudad,
                    estado: factura.estado,
                    zip: factura.zip,
                    fechaRegistro: new Date().toISOString()
                });
            } else {
                // Actualizar datos del cliente si han cambiado
                clienteExistente.telefono = factura.telefono || clienteExistente.telefono;
                clienteExistente.correo = factura.correo || clienteExistente.correo;
                clienteExistente.direccion = factura.direccion || clienteExistente.direccion;
                clienteExistente.ciudad = factura.ciudad || clienteExistente.ciudad;
                clienteExistente.estado = factura.estado || clienteExistente.estado;
                clienteExistente.zip = factura.zip || clienteExistente.zip;
            }

            guardarDatos();
            
            // Mostrar confirmaci√≥n con n√∫mero de factura
            alert(`‚úÖ Factura ${factura.numero} creada correctamente\n\n` +
                  `Cliente: ${cliente}\n` +
                  `Total: $${total.toFixed(2)}\n` +
                  `Art√≠culos: ${items.length}`);
            
            nuevaFactura();
        }

        // NUEVA FACTURA
        function nuevaFactura() {
            // Limpiar items y mensajes
            items = [];
            mensajes = [];
            
            // Actualizar visualizaci√≥n
            actualizarTablaItems();
            calcularTotales();
            
            // Limpiar campos del cliente
            limpiarCliente();
            
            // Resetear valores
            document.getElementById('descuento').value = '0';
            document.getElementById('envio').value = '0';
            document.getElementById('pagoInicial').value = '0';
            document.getElementById('modoVenta').value = 'Contado';
            togglePagoInicial();
            
            // Actualizar n√∫mero de factura
            facturaActual = facturas.length + 1;
            actualizarNumeroFactura();
            
            // Fecha actual
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('fechaFactura').value = hoy;
        }

        // ACTUALIZAR N√öMERO DE FACTURA
        function actualizarNumeroFactura() {
            const numero = `FAC-${String(facturaActual).padStart(4, '0')}`;
            document.getElementById('numeroFactura').value = numero;
        }

        // BUSCAR CLIENTES
        function buscarClientes() {
            const termino = document.getElementById('buscarClienteInput').value.toLowerCase();
            const resultados = clientes.filter(c => 
                c.nombre.toLowerCase().includes(termino) ||
                (c.telefono && c.telefono.includes(termino)) ||
                (c.correo && c.correo.toLowerCase().includes(termino))
            );

            const container = document.getElementById('clientesResults');
            
            if (resultados.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <div class="empty-state-text">No se encontraron clientes</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = resultados.map(cliente => `
                <div class="client-item" onclick='seleccionarCliente(${JSON.stringify(cliente)})'>
                    <div class="client-name">${cliente.nombre}</div>
                    <div class="client-details">
                        ${cliente.telefono || ''} ${cliente.telefono && cliente.correo ? '‚Ä¢' : ''} ${cliente.correo || ''}
                        ${cliente.direccion ? '<br>' + cliente.direccion : ''}
                    </div>
                </div>
            `).join('');
        }

        // SELECCIONAR CLIENTE
        function seleccionarCliente(cliente) {
            // Llenar datos
            document.getElementById('clienteNombre').value = cliente.nombre || '';
            document.getElementById('clienteTelefono').value = cliente.telefono || '';
            document.getElementById('clienteCorreo').value = cliente.correo || '';
            document.getElementById('clienteDireccion').value = cliente.direccion || '';
            document.getElementById('clienteCiudad').value = cliente.ciudad || '';
            document.getElementById('clienteEstado').value = cliente.estado || '';
            document.getElementById('clienteZip').value = cliente.zip || '';
            
            closeModal('buscarClienteModal');
        }

        // MOSTRAR VENTAS
        function mostrarVentas() {
            const container = document.getElementById('ventasList');
            
            if (facturas.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <div class="empty-state-text">No hay ventas registradas</div>
                    </div>
                `;
                
                document.getElementById('totalVentasCount').textContent = '0';
                document.getElementById('totalVentasAmount').textContent = '$0.00';
                document.getElementById('promedioVentas').textContent = '$0.00';
                return;
            }

            const totalVentas = facturas.reduce((sum, f) => sum + f.total, 0);
            const promedio = totalVentas / facturas.length;

            document.getElementById('totalVentasCount').textContent = facturas.length;
            document.getElementById('totalVentasAmount').textContent = `$${totalVentas.toFixed(2)}`;
            document.getElementById('promedioVentas').textContent = `$${promedio.toFixed(2)}`;

            container.innerHTML = [...facturas].reverse().map(factura => `
                <div class="invoice-item">
                    <div class="invoice-number">${factura.numero}</div>
                    <div class="invoice-info">
                        <div class="invoice-client">${factura.cliente}</div>
                        <div class="invoice-date">${factura.fecha} ‚Ä¢ ${factura.tipoPago}</div>
                    </div>
                    <div class="invoice-total">$${factura.total.toFixed(2)}</div>
                    <div>
                        <span class="badge ${factura.modoVenta === 'Contado' ? 'badge-success' : 'badge-warning'}">
                            ${factura.modoVenta}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        // FILTRAR VENTAS
        function filtrarVentas() {
            const mes = document.getElementById('filtroMes').value;
            const ano = document.getElementById('filtroAno').value;
            const busqueda = document.getElementById('buscarFactura').value.toLowerCase();

            let facturasFiltradas = [...facturas];

            if (mes) {
                facturasFiltradas = facturasFiltradas.filter(f => f.fecha.substring(5, 7) === mes);
            }

            if (ano) {
                facturasFiltradas = facturasFiltradas.filter(f => f.fecha.substring(0, 4) === ano);
            }

            if (busqueda) {
                facturasFiltradas = facturasFiltradas.filter(f => 
                    f.cliente.toLowerCase().includes(busqueda) ||
                    f.numero.toLowerCase().includes(busqueda)
                );
            }

            const container = document.getElementById('ventasList');
            
            if (facturasFiltradas.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <div class="empty-state-text">No se encontraron resultados</div>
                    </div>
                `;
                return;
            }

            const totalVentas = facturasFiltradas.reduce((sum, f) => sum + f.total, 0);
            const promedio = totalVentas / facturasFiltradas.length;

            document.getElementById('totalVentasCount').textContent = facturasFiltradas.length;
            document.getElementById('totalVentasAmount').textContent = `$${totalVentas.toFixed(2)}`;
            document.getElementById('promedioVentas').textContent = `$${promedio.toFixed(2)}`;

            container.innerHTML = facturasFiltradas.reverse().map(factura => `
                <div class="invoice-item">
                    <div class="invoice-number">${factura.numero}</div>
                    <div class="invoice-info">
                        <div class="invoice-client">${factura.cliente}</div>
                        <div class="invoice-date">${factura.fecha} ‚Ä¢ ${factura.tipoPago}</div>
                    </div>
                    <div class="invoice-total">$${factura.total.toFixed(2)}</div>
                    <div>
                        <span class="badge ${factura.modoVenta === 'Contado' ? 'badge-success' : 'badge-warning'}">
                            ${factura.modoVenta}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        // MOSTRAR ART√çCULOS
        function mostrarArticulos() {
            buscarArticulos();
        }

        // BUSCAR ART√çCULOS
        function buscarArticulos() {
            const termino = document.getElementById('buscarArticulo').value.toLowerCase();
            const resultados = articulos.filter(a => 
                a.descripcion.toLowerCase().includes(termino)
            );

            const container = document.getElementById('articulosResults');
            
            if (resultados.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì¶</div>
                        <div class="empty-state-text">No hay art√≠culos guardados</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = resultados.map(articulo => `
                <div class="client-item" onclick='usarArticulo(${JSON.stringify(articulo)})'>
                    <div class="client-name">${articulo.descripcion}</div>
                    <div class="client-details">Precio: $${articulo.precio.toFixed(2)}</div>
                </div>
            `).join('');
        }

        // USAR ART√çCULO
        function usarArticulo(articulo) {
            document.getElementById('itemDescripcion').value = articulo.descripcion;
            document.getElementById('itemPrecio').value = articulo.precio;
            closeModal('articulosModal');
        }

        // MOSTRAR CLIENTES GESTI√ìN
        function mostrarClientesGestion() {
            buscarClientesGestion();
        }

        // BUSCAR CLIENTES GESTI√ìN
        function buscarClientesGestion() {
            const termino = document.getElementById('buscarClienteGestion').value.toLowerCase();
            const resultados = clientes.filter(c => 
                c.nombre.toLowerCase().includes(termino)
            );

            const container = document.getElementById('clientesGestionResults');
            
            if (resultados.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üë•</div>
                        <div class="empty-state-text">No hay clientes registrados</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = resultados.map((cliente, index) => `
                <div class="client-item" style="cursor: default;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div class="client-name">${cliente.nombre}</div>
                            <div class="client-details">
                                ${cliente.telefono ? 'üìû ' + cliente.telefono : ''} 
                                ${cliente.telefono && cliente.correo ? ' ‚Ä¢ ' : ''} 
                                ${cliente.correo ? '‚úâÔ∏è ' + cliente.correo : ''}
                                ${cliente.direccion ? '<br>üìç ' + cliente.direccion : ''}
                                ${(cliente.ciudad || cliente.estado || cliente.zip) ? ', ' + [cliente.ciudad, cliente.estado, cliente.zip].filter(x => x).join(', ') : ''}
                                ${cliente.notas ? '<br>üìù ' + cliente.notas : ''}
                                ${cliente.fechaRegistro ? '<br><small style="opacity: 0.6;">Registrado: ' + new Date(cliente.fechaRegistro).toLocaleDateString() + '</small>' : ''}
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick='editarCliente(${JSON.stringify(cliente).replace(/'/g, "&#39;")})' style="padding: 0.5rem 1rem; margin-left: 1rem;">
                            <span>‚úèÔ∏è</span> Editar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // EDITAR CLIENTE
        function editarCliente(cliente) {
            closeModal('clientesModal');
            openModal('registrarClienteModal');
            
            // Llenar formulario con datos del cliente
            document.getElementById('nuevoClienteNombre').value = cliente.nombre || '';
            document.getElementById('nuevoClienteTelefono').value = cliente.telefono || '';
            document.getElementById('nuevoClienteCorreo').value = cliente.correo || '';
            document.getElementById('nuevoClienteDireccion').value = cliente.direccion || '';
            document.getElementById('nuevoClienteCiudad').value = cliente.ciudad || '';
            document.getElementById('nuevoClienteEstado').value = cliente.estado || '';
            document.getElementById('nuevoClienteZip').value = cliente.zip || '';
            document.getElementById('nuevoClientePais').value = cliente.pais || 'USA';
            document.getElementById('nuevoClienteNotas').value = cliente.notas || '';
        }

        // GENERAR PDF
        function generarPDF() {
            if (items.length === 0) {
                alert('No hay art√≠culos en la factura para generar PDF');
                return;
            }
            alert('üöß Funci√≥n de generaci√≥n de PDF en desarrollo.\n\nPor ahora, puedes usar la funci√≥n de imprimir y guardar como PDF desde el navegador.');
        }

        // IMPRIMIR FACTURA
        function imprimirFactura() {
            if (items.length === 0) {
                alert('No hay art√≠culos en la factura para imprimir');
                return;
            }

            const numero = document.getElementById('numeroFactura').value;
            const fecha = document.getElementById('fechaFactura').value;
            const cliente = document.getElementById('clienteNombre').value;
            const direccion = document.getElementById('clienteDireccion').value;
            const telefono = document.getElementById('clienteTelefono').value;
            
            const subtotal = items.reduce((sum, item) => sum + item.total, 0);
            const descuento = parseFloat(document.getElementById('descuento').value) || 0;
            const envio = parseFloat(document.getElementById('envio').value) || 0;
            const pagoInicial = parseFloat(document.getElementById('pagoInicial').value) || 0;
            const modo = document.getElementById('modoVenta').value;
            const subtotalConDescuento = subtotal - (subtotal * (descuento / 100));
            const subtotalConEnvio = subtotalConDescuento + envio;
            const total = modo === 'Cr√©dito' ? Math.max(0, subtotalConEnvio - pagoInicial) : subtotalConEnvio;

            const ventanaImpresion = window.open('', '_blank');
            ventanaImpresion.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Factura ${numero}</title>
                    <style>
                        @page { margin: 20mm; }
                        body {
                            font-family: Arial, sans-serif;
                            color: #000;
                            margin: 0;
                            padding: 20px;
                        }
                        .header {
                            border: 2px solid #000;
                            padding: 20px;
                            margin-bottom: 20px;
                            display: flex;
                            align-items: center;
                            gap: 20px;
                        }
                        .logo-container {
                            width: 80px;
                            height: 80px;
                            flex-shrink: 0;
                        }
                        .logo-container img {
                            width: 100%;
                            height: 100%;
                            object-fit: cover;
                            border-radius: 50%;
                        }
                        .company-info-container {
                            flex: 1;
                        }
                        .company-name {
                            font-size: 24px;
                            font-weight: bold;
                            margin-bottom: 5px;
                        }
                        .company-info {
                            font-size: 11px;
                            margin-bottom: 3px;
                        }
                        .invoice-info {
                            text-align: right;
                            margin-bottom: 20px;
                        }
                        .client-info {
                            margin-bottom: 30px;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 20px;
                        }
                        th, td {
                            border: 1px solid #000;
                            padding: 10px;
                            text-align: left;
                        }
                        th {
                            background: #f0f0f0;
                        }
                        .text-right { text-align: right; }
                        .totals {
                            margin-left: 60%;
                        }
                        .total-final {
                            font-size: 18px;
                            font-weight: bold;
                        }
                        .footer {
                            text-align: center;
                            margin-top: 40px;
                            border-top: 2px solid #000;
                            padding-top: 20px;
                            font-style: italic;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        ${configEmpresa.logo ? `
                            <div class="logo-container">
                                <img src="${configEmpresa.logo}" alt="Logo">
                            </div>
                        ` : ''}
                        <div class="company-info-container">
                            <div class="company-name">${configEmpresa.nombre}</div>
                            <div class="company-info">${configEmpresa.slogan}</div>
                            ${configEmpresa.taxId ? `<div class="company-info">Tax ID: ${configEmpresa.taxId}</div>` : ''}
                            ${configEmpresa.direccion ? `<div class="company-info">${configEmpresa.direccion}</div>` : ''}
                            ${configEmpresa.ciudad || configEmpresa.estado ? `<div class="company-info">${configEmpresa.ciudad}, ${configEmpresa.estado} ${configEmpresa.zip}</div>` : ''}
                            ${configEmpresa.telefono ? `<div class="company-info">Tel: ${configEmpresa.telefono}</div>` : ''}
                            ${configEmpresa.email ? `<div class="company-info">Email: ${configEmpresa.email}</div>` : ''}
                            ${configEmpresa.web ? `<div class="company-info">Web: ${configEmpresa.web}</div>` : ''}
                        </div>
                    </div>

                    <div class="invoice-info">
                        <strong>FACTURA ${numero}</strong><br>
                        Fecha: ${fecha}
                    </div>

                    <div class="client-info">
                        <strong>Facturar a:</strong><br>
                        ${cliente}<br>
                        ${direccion}<br>
                        Tel: ${telefono}
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>Descripci√≥n</th>
                                <th class="text-right">Cant.</th>
                                <th class="text-right">Precio</th>
                                <th class="text-right">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${items.map(item => `
                                <tr>
                                    <td>${item.descripcion}</td>
                                    <td class="text-right">${item.cantidad.toFixed(2)}</td>
                                    <td class="text-right">$${item.precio.toFixed(2)}</td>
                                    <td class="text-right">$${item.total.toFixed(2)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>

                    <div class="totals">
                        <table>
                            <tr>
                                <td><strong>Subtotal:</strong></td>
                                <td class="text-right">$${subtotal.toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td>Descuento (${descuento}%):</td>
                                <td class="text-right">-$${(subtotal * descuento / 100).toFixed(2)}</td>
                            </tr>
                            ${envio > 0 ? `
                            <tr>
                                <td>Env√≠o:</td>
                                <td class="text-right">$${envio.toFixed(2)}</td>
                            </tr>
                            ` : ''}
                            ${modo === 'Cr√©dito' && pagoInicial > 0 ? `
                            <tr>
                                <td>Pago Inicial:</td>
                                <td class="text-right">-$${pagoInicial.toFixed(2)}</td>
                            </tr>
                            ` : ''}
                            <tr class="total-final">
                                <td><strong>TOTAL:</strong></td>
                                <td class="text-right"><strong>$${total.toFixed(2)}</strong></td>
                            </tr>
                        </table>
                    </div>

                    <div class="footer">
                        ${configEmpresa.nombre}
                    </div>
                </body>
                </html>
            `);

            ventanaImpresion.document.close();
            setTimeout(() => {
                ventanaImpresion.print();
            }, 250);
        }

        // GENERAR A√ëOS PARA SELECT
        function generarAnosSelect() {
            const select = document.getElementById('filtroAno');
            const anoActual = new Date().getFullYear();
            
            for (let i = anoActual; i >= 2020; i--) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                select.appendChild(option);
            }
        }

        // GUARDAR DATOS EN LOCALSTORAGE
        function guardarDatos() {
            localStorage.setItem('facturas', JSON.stringify(facturas));
            localStorage.setItem('clientes', JSON.stringify(clientes));
            localStorage.setItem('articulos', JSON.stringify(articulos));
            localStorage.setItem('facturaActual', facturaActual);
        }

        // CARGAR DATOS DE LOCALSTORAGE
        function cargarDatos() {
            const facturasGuardadas = localStorage.getItem('facturas');
            const clientesGuardados = localStorage.getItem('clientes');
            const articulosGuardados = localStorage.getItem('articulos');
            const facturaActualGuardada = localStorage.getItem('facturaActual');

            if (facturasGuardadas) {
                try {
                    facturas = JSON.parse(facturasGuardadas);
                } catch (e) {
                    facturas = [];
                }
            }

            if (clientesGuardados) {
                try {
                    clientes = JSON.parse(clientesGuardados);
                } catch (e) {
                    clientes = [];
                }
            }

            if (articulosGuardados) {
                try {
                    articulos = JSON.parse(articulosGuardados);
                } catch (e) {
                    articulos = [];
                }
            }

            if (facturaActualGuardada) {
                facturaActual = parseInt(facturaActualGuardada) || 1;
            } else {
                facturaActual = facturas.length + 1;
            }
        }

        // ATAJOS DE TECLADO
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + N = Nueva factura
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                nuevaFactura();
            }
            
            // Ctrl/Cmd + S = Crear factura
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                crearFactura();
            }
            
            // Ctrl/Cmd + P = Imprimir
            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                e.preventDefault();
                imprimirFactura();
            }
        });
    </script>
</body>
</html>